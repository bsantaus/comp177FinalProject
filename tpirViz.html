
<!DOCTYPE html>
<meta charset="utf-8">
<style>

html,body {
    height:100%;
    width:100%;
    font-family:"Trebuchet MS", Helvetica, sans-serif;
    font-size:1.2vw;
}

img {
    max-width:100%;
    max-height:100%;
    display:block;
    padding: 10px;
}

.column {
    float:left;
    padding:1%;
}

.row {
    height:100%;
    width:100%;
}

.row::after {
    content:"";
    display:table;
    clear:both;
}

.opt {
    width:20%;
    border:2px solid black;
}

.ctrSvg {
    width:70%;
    padding-right:2%;
    margin-left:1%;
    margin-right:1%;
}

.meta {
    width:98%;
    padding-right:1%;
    margin:0;
    border:2px solid black;
}

.metaName {
    height:5%;
}

.legendItem {
    height:4%;
    width:100%;
}

.text {
    padding: 40px 0px;
    text-align:left;
    white-space:nowrap;
    overflow:hidden;
}

.leggo {
  background-color: #d0f5df;
  border: none;
  color: gray;
  padding: 16px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  transition-duration: 0.4s;
  cursor: pointer;
  border: 2px solid gray;
  border-radius:1vw;
}

.leggo:hover {
    background-color:gray;
    color:#d0f5df;
}

</style>

<!--Category: S29-47, Frequency: S1-47, Slots: S16-47, W/L: S29-47-->
<body>
<div style="display:flex; flex-flow:column; height:100%; width:98%; margin:0px;">
<div id="title" class="row" style="height:97%; width:100%; margin:0px; padding:0px; border: 2px solid black; border-radius: 5px; background-color:#d0f5df">
    <div class='column' style="height:100%; width:50%; text-align:center; padding: 15vw 0px">
        <h1>The Price Is Right Pricing Games</h1>
        <p>Frequency and Win-Loss Percentage for every game ever played.</p>
        <button class="leggo">Come on Down</button>
    </div>
    <div class="column" style="height:100%; width:42%">
        <div style="height:45%; width:100%; margin:5px">
            <img id="barker" src="barker.jpg" height="100%" width="100%">
        </div>
        <div style="height:45%; width:100%; margin:5px;" height="100%" width="100%">
            <img id="carey" src="carey.jpg">
        </div>
    </div>
</div>
<hr>
<div class="row" style="height:69%">
    <div class="column opt" style="height:90%; background-color:#d0f5df; border-radius:5px;">
        <label for="Categories">Category:</label>
        <select id="Categories">
            <option value="all">All Games</option>
            <option value="cat">Grouped By Category</option>
            <option value="car">Car Games</option>
            <option value="cash">Cash Games</option>
            <option value="small">Small Prize Games</option>
            <option value="grocery">Grocery Product Games</option>
            <option value="onep">1 Prize Games</option>
            <option value="twop">2 Prize Games</option>
            <option value="threep">3 Prize Games</option>
            <option value="fourp">4+ Prize Games</option>
        </select><br>
        <label for="View">View:</label>
        <select id="View">
            <option value="all">All</option>
            <option value="5">Top 5</option>
            <option value="10">Top 10</option>
            <option value="20">Top 20</option>
            <option value="50">Top 50</option>
        </select><br>
        <label for="Plot">Plot:</label>
        <select id="Plot">
            <option value="fwl">Frequency vs Win %</option>
            <option value="fr">Frequency</option>
            <option value="cat">Win %</option>
        </select><br>
        <label for="Active">Show only Active Games?</label>
        <select id="Active">
            <option value="n">No</option>
            <option value="y">Yes</option>
        </select><br>
        <hr>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #e3655b;"></div><div class="column" style="width:70%"><font color="black">Car Games</font></div></div><br>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #2ca02c;"></div><div class="column" style="width:70%"><font color="black">Cash Games</font></div></div><br>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #fbb02d;"></div><div class="column" style="width:70%"><font color="black">Grocery Product Games</font></div></div><br>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #B04CC8;"></div><div class="column" style="width:70%"><font color="black">Small Prize Games</font></div></div><br>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #abbafc;"></div><div class="column" style="width:70%"><font color="black">One Prize Games</font></div></div><br>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #7485cb;"></div><div class="column" style="width:70%"><font color="black">Two Prize Games</font></div></div><br>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #3d509a;"></div><div class="column" style="width:70%"><font color="black">Three Prize Games</font></div></div><br>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #061c6a;"></div><div class="column" style="width:70%"><font color="black">Four+ Prize Games</font></div></div><br>
        <div class="legendItem row"><div class="column" style="border-radius:5px; margin-right:10px; height:100%; width:10%; background-color: #a1a1a1;"></div><div class="column" style="width:70%"><font color="black">No Category Available</font></div></div>

    </div>
    <div id="ctrSvgDiv" class="column ctrSvg">
        <svg id="ctrSvg" style="position:relative; z-index:2"></svg>
    </div>
</div>
<div class="row meta" style="height:30%; width:99%; background-color:#d0f5df; border-radius:5px; margin-bottom:10px;">
    <div class="metaName column">
        <h3 id="gameName" style="margin:0"></h3>
        <svg id="slotSvg"></svg><br>
    </div>
    <div class="column text" style="font-size:1.1vw; width:26%;">
        <p id="metaApp">First Appearance:</p>
        <p id="metaCat">Categories:</p>
        <p id="metaTotal">Total Appearances:</p>
    </div>
    <div class="column text" style="font-size:1.1vw; width:15%">
        <p id="metaFrank">Total Appearances Rank:</p>
        <p id="metaActive">Seasons Active:</p>
        <p id="metaWPct">Overall Win %:</p>
    </div>
    <div class="column" style="width:27%; height:85%;">
        <iframe id="vid" width="100%" height="100%"
            src="">
        </iframe>
    </div>
</div>
</div>
</body>


<script src="js/d3.v4.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<script src="js/jquery-3.1.0.min.js"></script>
<script>

$(".leggo").click(function() {
    $('html,body').animate({
        scrollTop: "800px"},
        'slow');
});

var ctrSvg = d3.select("#ctrSvg");
var width = window.innerWidth * 0.67;
var height = window.innerHeight * 0.66;
ctrSvg.attr("width", width)
    .attr("height", height);

var slotSvg = d3.select("#slotSvg");
var slWidth = window.innerWidth * .25;
var slHeight = window.innerHeight * 0.2;
slotSvg.attr("width", slWidth)
    .attr("height", slHeight);

var fgText = "Appearances per Season Active";
var fcText = "Appearances per Season";
var wlText = "Win %";

var vidplayer = d3.select("#vid");
// var vidWidth = window.innerWidth * 0.25;
// var vidHeight = window.innerHeight * 0.25;
// vidplayer.attr('width', vidWidth)
//         .attr('height', vidHeight);

var barker = d3.select("#barker");
var carey = d3.select("#carey");
carey.attr("height", barker.attr("height"));
console.log(carey.attr("height"))
carey.attr("width", barker.attr("width"));


</script>
<script type="text/javascript" src="gradients.js"></script>
<script type="text/javascript" src="fills.js"></script>
<script type="text/javascript" src="createPlot.js"></script>
<script type="text/javascript" src="remakePlot.js"></script>
<script src="slotBar.js"></script>
<script>
var gameData = d3.map();
var categoryData = d3.map();
var games = [];
var categories = ["CarGames", "CashGames", "GroceryProductGames", "SmallPrizeGames", "OnePrizeGames", "TwoPrizeGames", "ThreePrizeGames", "FourFivePrizeGames"];

var currCat = "all";
var currView = "all";
var currPlot = "fwl";
var currAct = "n";

d3.select("#gameName").text("Game Metadata");

d3.queue()
    .defer(d3.tsv, "frequency.tsv"+'?' + Math.floor(Math.random() * 1000), function(d) {
        gameData.set(d.PricingGame, {f1:d.f1, f2:d.f2, f3:d.f3, f4:d.f4, f5:d.f5, f6:d.f6,
            f7:d.f7, f8:d.f8, f9:d.f9, f10:d.f10, f11:d.f11, f12:d.f12,
            f13:d.f13, f14:d.f14, f15:d.f15, f16:d.f16, f17:d.f17, f18:d.f18,
            f19:d.f19, f20:d.f20, f21:d.f21, f22:d.f22, f23:d.f23, f24:d.f24,
            f25:d.f25, f26:d.f26, f27:d.f27, f28:d.f28, f29:d.f29, f30:d.f30,
            f31:d.f31, f32:d.f2, f33:d.f33, f34:d.f34, f35:d.f35, f36:d.f36,
            f37:d.f37, f38:d.f38, f39:d.f39, f40:d.f40, f41:d.f41, f42:d.f42,
            f43:d.f43, f44:d.f44, f45:d.f45, f46:d.f46, f47:d.f47, fTotal:d.fTotal, fRank:d.fRank, fActive:d.fActive, Category:d.Category, YTID:d.YTID});
        games.push(d.PricingGame);
    })
    .defer(d3.tsv, "winLoss.tsv"+'?' + Math.floor(Math.random() * 1000), function (d) {
        let gd = gameData.get(d.PricingGame);
        let newobj = {...gd, w29:d.w29, w30:d.w30,
            w31:d.w31, w32:d.w32, w33:d.w33, w34:d.w34, w35:d.w35, w36:d.w36,
            w37:d.w37, w38:d.w38, w39:d.w39, w40:d.w40, w41:d.w41, w42:d.w42,
            w43:d.w43, w44:d.w44, w45:d.w45, w46:d.w46, w47:d.w47, wTotal:d.wTotal, wPct:d.wPct, wRank:d.wRank};

        gameData.set(d.PricingGame, newobj);
    })
    .defer(d3.tsv, "gameSlots.tsv"+'?' + Math.floor(Math.random() * 1000), function(d) {
        let gd = gameData.get(d.PricingGame);
        let newobj = {...gd, s1:d.s1, s2:d.s2, s3:d.s3, s4:d.s4, s5:d.s5, s6:d.s6, sNA:d.sNA};
        gameData.set(d.PricingGame, newobj);
    })
    .defer(d3.tsv, "category.tsv"+'?' + Math.floor(Math.random() * 1000), function(d) {
        categoryData.set("CarGames", {wl:d.CarGames, niceText:"Car Games", color:"#e3655b", abbr:"car"});
        categoryData.set("CashGames", {wl:d.CashGames, niceText:"Cash Games", color:cashColor, abbr:"cash"});
        categoryData.set("GroceryProductGames", {wl:d.GroceryProductGames, niceText:"Grocery Product Games", color:groceryColor, abbr:"gr"});
        categoryData.set("SmallPrizeGames", {wl:d.SmallPrizeGames, niceText:"Small Prize Games", color:smallColor, abbr:"sm"});
        categoryData.set("OnePrizeGames", {wl:d.OnePrizeGames, niceText:"One Prize Games", color:oneColor, abbr:"1"});
        categoryData.set("TwoPrizeGames", {wl:d.TwoPrizeGames, niceText:"Two Prize Games", color:twoColor, abbr:"2"});
        categoryData.set("ThreePrizeGames", {wl:d.ThreePrizeGames, niceText:"Three Prize Games", color:threeColor, abbr:"3"});
        categoryData.set("FourFivePrizeGames", {wl:d.FourFivePrizeGames, niceText:"Four+ Prize Games", color:fourColor, abbr:"4"});
    })
    .await(ready);

// Add X axis
var heightShift = height * 0.85 - 50;
var widthShift = width * 0.06 + 30;



var x;
var y;
var sy;
var currentShape = 'circle';
var tdone = false;
var clicked = false;

function ready(error, data) {
    let xr = (width * .96 - widthShift) / 2 + widthShift;
    let yr = (heightShift - (height * 0.02)) / 2 + (height * 0.02);

    x = d3.scaleLinear()
    .domain([0, 40])
    .range([ widthShift, width * 0.96]);
    
    y = d3.scaleLinear()
    .domain([0,100])
    .range([ heightShift, height * 0.02]);

    ctrSvg.append("g")
        .attr("id", "xax")
        .attr("transform", "translate(0," + heightShift + ")")
        .call(d3.axisBottom(x));
    ctrSvg.append("g")
        .attr("id", "yax")
        .attr("transform", "translate(" + widthShift + ",0)")
        .call(d3.axisLeft(y));
    ctrSvg.append("text")
        .attr("id", "xLabel")
        .attr("transform", "translate(" + xr + " ," + (heightShift + 50) + ")")
        .style("text-anchor", "middle")
        .text(fgText);
    ctrSvg.append("text")
        .attr("id", "yLabel")
        .attr("transform", "translate(" + (widthShift - 50) + " ," + yr + "), rotate(-90)")
        .style("text-anchor", "middle")
        .text(wlText);
    for (var i = 0; i < games.length; i++) {
        let game = games[i];
        if(gameData.get(game).wPct) {
            ctrSvg.append("circle")
                .attr("cx", function() { return x(parseFloat(gameData.get(game).fTotal) / parseFloat(gameData.get(game).fActive)); })
                .attr("cy", function() { return y(parseFloat(gameData.get(game).wPct) * 100); })
                .attr("id", game)
                .attr("r", height * width / 75000)
                .style("fill", getFill(gameData.get(game).Category))
                .on("mouseenter", function() { if(!clicked) editMeta(game) })
                .on("click", function() {
                    if (clicked != game) {
                        d3.selectAll("circle")
                            .transition()
                            .style("opacity", function() { return (d3.select(this).attr("id") == game ? 1 : .5)})
                            .duration(100);
                        clicked = game;
                        editMeta(game);
                    } else {
                        d3.selectAll("circle")
                            .transition()
                            .style("opacity", 1)
                            .duration(100);
                        clicked = undefined;
                        editMeta(game);
                    }
                });
        }
    }

    sx = d3.scaleBand()
            .range([slWidth * 0.02, slWidth * 0.98])
            .domain(['1', '2', '3', '4', '5', '6', '?'])
            .padding(0.1);

    sy = d3.scaleLinear()
           .range([slHeight * 0.9 - 25, slHeight * 0.25]);
    
    sxr = ((slWidth * .98) - (slWidth * 0.02)) / 2 + slHeight * 0.9;


    slotSvg.append("g")
        .attr("id", "xax")
        .attr("transform", "translate(0," + (slHeight * 0.9 - 25) + ")")
        .call(d3.axisBottom(sx));
    slotSvg.append("text")
        .attr("id", "sxLabel")
        .attr("transform", "translate(" + slWidth / 2 + " ," + (slHeight * 0.95) + ")")
        .style("text-anchor", "middle")
        .text("Appearances per Game Slot in Show");

    for (var i = 1; i < 8; i++) {
        slotSvg.append('g')
            .attr('id', "gslot" + i)
            .append('rect')
            .attr("id", "slot" + i)
            .style('fill', 'black')
            .attr('y', slHeight * 0.9 - 25)
            .attr('x', sx(i == 7 ? "?" : i.toString()))
            .attr('height', 0)
            .attr("width", sx.bandwidth())
            
        d3.select("#gslot" + i).append('text')
            .attr('x', sx(i == 7 ? "?" : i.toString()) + (sx.bandwidth() / 2))
            .attr('y', slHeight * 0.9 - 40)
            .attr('text-anchor', 'middle')
            .text('-')
            .style('opacity', '0')
            .attr("fill", "black");
    }
}

function editMeta(game) {
    d3.select("#gameName").text(game);
    populateSlotBar(gameData.get(game));
    vidplayer.attr('src', "https://www.youtube.com/embed/" + gameData.get(game).YTID)
}

document.getElementById("Categories").onchange = updateViz;
document.getElementById("View").onchange = updateViz;
document.getElementById("Plot").onchange = updateViz;
document.getElementById("Active").onchange = updateViz;
</script>